extends ../../layouts/default.pug
include ../../mixins/alert.pug

block main
  +alert-success(message)
  +alert-error(message)

  .container-fluid
    .row
      form(method='POST', action='/admin/articles/create', enctype='multipart/form-data')
        .col-md-8.offset-md-2
          .card.shadow-sm
            // ğŸ‘‰ Header cá»§a form
            .card-header.bg-primary.text-white
              h5.mb-0 Táº¡o BÃ i BÃ¡o Má»›i

            
            .card-body
            
              // ğŸ“Œ TiÃªu Äá»
              .mb-3
                label.form-label(for='title') TiÃªu Äá» *
                input.form-control(
                  type='text', 
                  name='title', 
                  id='title'
                  placeholder='Nháº­p tiÃªu Ä‘á» bÃ i bÃ¡o'
                )

              // ğŸ“Œ MÃ´ Táº£ Ngáº¯n
              .mb-3
                label.form-label(for='summary') MÃ´ Táº£ Ngáº¯n
                textarea.form-control(
                  name='summary', 
                  id='summary', 
                  rows='2', 
                  placeholder='Nháº­p mÃ´ táº£ ngáº¯n'
                )

              // ğŸ“Œ Ná»™i Dung
              .mb-3
                label.form-label(for='content') Ná»™i Dung *
                textarea.form-control.bg-light-subtle.tinymce-app(
                  id="content",
                  name="content",
                  rows="7",
                )

              // ğŸ“Œ áº¢nh Thumbnail
              .mb-3
                label.form-label(for='thumbnail') áº¢nh Thumbnail (Táº£i lÃªn)
                input.form-control(
                  type='file', 
                  name='thumbnail', 
                  id='thumbnail', 
                  accept='image/*'
                )
                small.form-text.text-muted Dung lÆ°á»£ng tá»‘i Ä‘a: 5MB. Äá»‹nh dáº¡ng: jpg, png, jpeg.

                // ğŸ‘‰ VÃ¹ng hiá»ƒn thá»‹ áº£nh Preview
                .mt-3
                  label.form-label Preview áº¢nh
                  img#thumbnail-preview(
                    src='', 
                    alt='Preview Thumbnail', 
                    class='img-thumbnail d-none', 
                    style='max-width: 200px; height: auto;'
                  )

              // ğŸ“Œ Tráº¡ng ThÃ¡i
              .mb-3
                label.form-label(for='status') Tráº¡ng ThÃ¡i
                select.form-select(name='status', id='status')
                  option(value='active') Hoáº¡t Äá»™ng
                  option(value='inactive') KhÃ´ng Hoáº¡t Äá»™ng

              // ğŸ“Œ NÃºt HÃ nh Äá»™ng
              .text-end
                button.btn.btn-success.btn-lg(type='submit') Táº¡o BÃ i BÃ¡o
                a.btn.btn-secondary.btn-lg.ms-2(href='/admin/articles/list') Há»§y


  // ğŸ‘‰ Script Preview áº¢nh Thumbnail
  script.
    document.getElementById('thumbnail').addEventListener('change', function(event) {
      const file = event.target.files[0];
      const preview = document.getElementById('thumbnail-preview');

      if (file) {
        const reader = new FileReader();

        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.classList.remove('d-none');
        };

        reader.readAsDataURL(file);
      } else {
        preview.src = '';
        preview.classList.add('d-none');
      }
    });

  script.
    document.querySelector('form').addEventListener('submit', function(event) {
      if (tinymce) {
        tinymce.triggerSave(); // Äá»“ng bá»™ dá»¯ liá»‡u tá»« TinyMCE vá» textarea gá»‘c
      }

      const content = document.getElementById('content').value.trim();
      if (!content) {
        alert('Ná»™i dung lÃ  báº¯t buá»™c!');
        document.getElementById('content').focus();
        event.preventDefault();
      }
    });