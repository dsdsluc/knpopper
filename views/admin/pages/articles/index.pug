extends ../../layouts/default.pug
include ../../mixins/alert.pug

block main
  +alert-success(message)
  +alert-error(message)

  .container-fluid
    .row.mb-4
      .col-md-6
        h3.text-primary Danh S√°ch B√†i B√°o
        p.text-muted Qu·∫£n l√Ω danh s√°ch b√†i b√°o tr√™n h·ªá th·ªëng.
      .col-md-6.text-end
        a.btn.btn-primary(href='/admin/articles/create') 
          i.fas.fa-plus.me-1
          | Th√™m B√†i B√°o

    .card.shadow-sm
      .card-header.bg-primary.text-white.d-flex.justify-content-between.align-items-center
        h5.mb-0 Danh S√°ch B√†i B√°o

      .card-body.p-0
        table.table.table-hover.table-bordered.mb-0
          thead.table-light
            tr.text-center
              th # ID
              th Ti√™u ƒê·ªÅ
              th T√≥m T·∫Øt
              th Tr·∫°ng Th√°i
              th L∆∞·ª£t Xem
              th Ng√†y Xu·∫•t B·∫£n
              th H√†nh ƒê·ªông
          tbody
            each article in articles
              tr.text-center
                td #{article._id}
                td.text-start #{article.title}
                td.text-start #{article.summary || 'Kh√¥ng c√≥ t√≥m t·∫Øt'}
                td
                  if article.status === 'active'
                    span.badge.bg-success.text-white Ho·∫°t ƒê·ªông
                  else
                    span.badge.bg-secondary.text-white Kh√¥ng Ho·∫°t ƒê·ªông
                td #{article.views}
                td #{article.publishedAt ? new Date(article.publishedAt).toLocaleString() : 'Ch∆∞a xu·∫•t b·∫£n'}
                td.d-flex.justify-content-center.gap-2
                  // üëâ N√∫t Xem Chi Ti·∫øt
                  a.btn.btn-sm.btn-info(
                    href=`/admin/articles/detail/${article._id}` 
                    title='Xem chi ti·∫øt'
                  ) 
                    i.fas.fa-eye.me-1
                    | Xem

                  // üëâ N√∫t Ch·ªânh S·ª≠a
                  a.btn.btn-sm.btn-warning(
                    href=`/admin/articles/edit/${article._id}` 
                    title='Ch·ªânh s·ª≠a'
                  ) 
                    i.fas.fa-edit.me-1
                    | S·ª≠a

                  // üëâ N√∫t X√≥a
                  button.btn.btn-sm.btn-danger(
                    title='X√≥a'
                    onclick=`openDeleteModal('${article._id}')`
                    data-bs-toggle='modal'
                    data-bs-target='#deleteModal'
                  ) 
                    i.fas.fa-trash-alt.me-1
                    | X√≥a

    .card-footer.text-muted.text-center.py-2
      | Hi·ªÉn th·ªã #{articles.length} b√†i b√°o tr√™n h·ªá th·ªëng.

  // üëâ Modal X√°c Nh·∫≠n X√≥a
  div#deleteModal.modal.fade(tabindex='-1', role='dialog')
    .modal-dialog.modal-dialog-centered
      .modal-content
        .modal-header.bg-danger.text-white
          h5.modal-title X√°c Nh·∫≠n X√≥a
          button.btn-close(data-bs-dismiss='modal', aria-label='Close')

        .modal-body
          p B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i b√°o n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.

        .modal-footer
          button.btn.btn-secondary(data-bs-dismiss='modal') H·ªßy
          form(id='delete-form', method='POST', action='')
            input(type='hidden', name='_method', value='DELETE')
            button.btn.btn-danger(type='submit') X√°c Nh·∫≠n X√≥a

  script.
    let deleteArticleId = null;

    function openDeleteModal(articleId) {
      deleteArticleId = articleId;
      const form = document.getElementById('delete-form');
      form.action = `/admin/articles/delete/${deleteArticleId}?_method=DELETE`;
    }
